<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .calculator {
            background: #2d2d2d;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            padding: 20px;
            max-width: 400px;
            width: 100%;
        }

        .display {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-end;
        }

        .display-expression {
            color: #888;
            font-size: 14px;
            margin-bottom: 5px;
            word-wrap: break-word;
            text-align: right;
        }

        .display-result {
            color: #fff;
            font-size: 32px;
            font-weight: bold;
            word-wrap: break-word;
            text-align: right;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        button {
            background: #3a3a3a;
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 18px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        button:hover {
            background: #4a4a4a;
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .operator {
            background: #f39c12;
        }

        .operator:hover {
            background: #f5ab35;
        }

        .function {
            background: #3498db;
            font-size: 14px;
        }

        .function:hover {
            background: #5dade2;
        }

        .equals {
            background: #27ae60;
            grid-column: span 2;
        }

        .equals:hover {
            background: #2ecc71;
        }

        .clear {
            background: #e74c3c;
        }

        .clear:hover {
            background: #ec7063;
        }

        .zero {
            grid-column: span 2;
        }

        h1 {
            color: #fff;
            text-align: center;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .mode-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .mode-toggle button {
            padding: 10px 20px;
            font-size: 14px;
            background: #3a3a3a;
            border-radius: 5px;
        }

        .mode-toggle button.active {
            background: #667eea;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>Scientific Calculator</h1>
        
        <div class="mode-toggle">
            <button id="scientificMode" class="active">Scientific Mode</button>
        </div>

        <div class="display">
            <div class="display-expression" id="expression"></div>
            <div class="display-result" id="result">0</div>
        </div>

        <div class="buttons" id="buttons">
            <!-- Buttons will be generated by JavaScript -->
        </div>
    </div>

    <script>
        class ScientificCalculator {
            constructor() {
                this.currentValue = '0';
                this.expression = '';
                this.lastResult = null;
                this.degreeMode = true; // true for degrees, false for radians
                
                this.expressionDisplay = document.getElementById('expression');
                this.resultDisplay = document.getElementById('result');
                
                this.createButtons();
                this.setupKeyboardInput();
            }

            createButtons() {
                const buttonLayout = [
                    { text: 'sin', class: 'function', action: () => this.applyFunction('sin') },
                    { text: 'cos', class: 'function', action: () => this.applyFunction('cos') },
                    { text: 'tan', class: 'function', action: () => this.applyFunction('tan') },
                    { text: 'DEG', class: 'function', action: () => this.toggleDegreeMode() },
                    { text: 'C', class: 'clear', action: () => this.clear() },
                    
                    { text: 'ln', class: 'function', action: () => this.applyFunction('ln') },
                    { text: 'log', class: 'function', action: () => this.applyFunction('log') },
                    { text: 'π', class: 'function', action: () => this.appendNumber('π') },
                    { text: 'e', class: 'function', action: () => this.appendNumber('e') },
                    { text: '÷', class: 'operator', action: () => this.appendOperator('/') },
                    
                    { text: '√', class: 'function', action: () => this.applyFunction('sqrt') },
                    { text: 'x²', class: 'function', action: () => this.applyFunction('square') },
                    { text: 'xʸ', class: 'function', action: () => this.appendOperator('^') },
                    { text: '(', class: 'operator', action: () => this.appendOperator('(') },
                    { text: ')', class: 'operator', action: () => this.appendOperator(')') },
                    
                    { text: '7', action: () => this.appendNumber('7') },
                    { text: '8', action: () => this.appendNumber('8') },
                    { text: '9', action: () => this.appendNumber('9') },
                    { text: '×', class: 'operator', action: () => this.appendOperator('*') },
                    { text: '←', class: 'operator', action: () => this.backspace() },
                    
                    { text: '4', action: () => this.appendNumber('4') },
                    { text: '5', action: () => this.appendNumber('5') },
                    { text: '6', action: () => this.appendNumber('6') },
                    { text: '−', class: 'operator', action: () => this.appendOperator('-') },
                    { text: '1/x', class: 'function', action: () => this.applyFunction('reciprocal') },
                    
                    { text: '1', action: () => this.appendNumber('1') },
                    { text: '2', action: () => this.appendNumber('2') },
                    { text: '3', action: () => this.appendNumber('3') },
                    { text: '+', class: 'operator', action: () => this.appendOperator('+') },
                    { text: 'n!', class: 'function', action: () => this.applyFunction('factorial') },
                    
                    { text: '0', class: 'zero', action: () => this.appendNumber('0') },
                    { text: '.', action: () => this.appendNumber('.') },
                    { text: '=', class: 'equals', action: () => this.calculate() }
                ];

                const buttonsContainer = document.getElementById('buttons');
                buttonsContainer.innerHTML = '';
                
                buttonLayout.forEach(btn => {
                    const button = document.createElement('button');
                    button.textContent = btn.text;
                    if (btn.class) button.className = btn.class;
                    button.addEventListener('click', btn.action);
                    if (btn.text === 'DEG') {
                        button.id = 'degreeToggle';
                    }
                    buttonsContainer.appendChild(button);
                });
            }

            appendNumber(num) {
                if (num === 'π') {
                    this.expression += 'π';
                } else if (num === 'e') {
                    this.expression += 'e';
                } else {
                    if (this.currentValue === '0' && num !== '.') {
                        this.currentValue = num;
                    } else {
                        this.currentValue += num;
                    }
                    this.expression += num;
                }
                this.updateDisplay();
            }

            appendOperator(op) {
                if (this.expression === '' && this.lastResult !== null) {
                    this.expression = this.lastResult.toString();
                }
                this.expression += op;
                this.currentValue = '0';
                this.updateDisplay();
            }

            applyFunction(func) {
                let value = this.currentValue;
                if (value === '0' && this.lastResult !== null) {
                    value = this.lastResult.toString();
                } else if (this.expression !== '') {
                    // Calculate current expression first
                    try {
                        value = this.evaluateExpression(this.expression).toString();
                    } catch (e) {
                        value = this.currentValue;
                    }
                }

                let result;
                const numValue = parseFloat(value);

                switch (func) {
                    case 'sin':
                        result = this.degreeMode ? 
                            Math.sin(numValue * Math.PI / 180) : 
                            Math.sin(numValue);
                        break;
                    case 'cos':
                        result = this.degreeMode ? 
                            Math.cos(numValue * Math.PI / 180) : 
                            Math.cos(numValue);
                        break;
                    case 'tan':
                        result = this.degreeMode ? 
                            Math.tan(numValue * Math.PI / 180) : 
                            Math.tan(numValue);
                        break;
                    case 'ln':
                        result = Math.log(numValue);
                        break;
                    case 'log':
                        result = Math.log10(numValue);
                        break;
                    case 'sqrt':
                        result = Math.sqrt(numValue);
                        break;
                    case 'square':
                        result = numValue * numValue;
                        break;
                    case 'reciprocal':
                        result = 1 / numValue;
                        break;
                    case 'factorial':
                        result = this.factorial(Math.floor(numValue));
                        break;
                }

                this.expression = '';
                this.currentValue = result.toString();
                this.lastResult = result;
                this.updateDisplay(result);
            }

            factorial(n) {
                if (n < 0) return NaN;
                if (n === 0 || n === 1) return 1;
                let result = 1;
                for (let i = 2; i <= n; i++) {
                    result *= i;
                }
                return result;
            }

            calculate() {
                if (this.expression === '') return;

                try {
                    const result = this.evaluateExpression(this.expression);
                    this.lastResult = result;
                    this.currentValue = result.toString();
                    this.expression = '';
                    this.updateDisplay(result);
                } catch (error) {
                    this.updateDisplay('Error');
                    this.expression = '';
                    this.currentValue = '0';
                }
            }

            evaluateExpression(expr) {
                // Replace mathematical constants
                expr = expr.replace(/π/g, Math.PI.toString());
                expr = expr.replace(/e/g, Math.E.toString());
                
                // Replace power operator
                expr = expr.replace(/\^/g, '**');
                
                // Evaluate the expression
                // Note: Using Function constructor for safe evaluation
                // In production, consider using a proper expression parser
                try {
                    return Function('"use strict"; return (' + expr + ')')();
                } catch (e) {
                    throw new Error('Invalid expression');
                }
            }

            clear() {
                this.currentValue = '0';
                this.expression = '';
                this.lastResult = null;
                this.updateDisplay();
            }

            backspace() {
                if (this.expression.length > 0) {
                    this.expression = this.expression.slice(0, -1);
                    this.updateDisplay();
                }
            }

            toggleDegreeMode() {
                this.degreeMode = !this.degreeMode;
                const toggle = document.getElementById('degreeToggle');
                toggle.textContent = this.degreeMode ? 'DEG' : 'RAD';
            }

            updateDisplay(result = null) {
                this.expressionDisplay.textContent = this.expression || '';
                this.resultDisplay.textContent = result !== null ? 
                    this.formatNumber(result) : 
                    (this.currentValue || '0');
            }

            formatNumber(num) {
                if (typeof num === 'string') return num;
                if (num === Infinity || num === -Infinity) return 'Infinity';
                if (isNaN(num)) return 'Error';
                
                // Format with appropriate precision
                if (Math.abs(num) < 1e-10 && num !== 0) {
                    return num.toExponential(6);
                }
                if (Math.abs(num) > 1e10) {
                    return num.toExponential(6);
                }
                
                // Round to avoid floating point errors
                const rounded = Math.round(num * 1e10) / 1e10;
                return rounded.toString();
            }

            setupKeyboardInput() {
                document.addEventListener('keydown', (e) => {
                    const key = e.key;
                    
                    if (key >= '0' && key <= '9') {
                        this.appendNumber(key);
                    } else if (key === '.') {
                        this.appendNumber('.');
                    } else if (key === '+' || key === '-') {
                        this.appendOperator(key);
                    } else if (key === '*') {
                        this.appendOperator('*');
                    } else if (key === '/') {
                        this.appendOperator('/');
                    } else if (key === 'Enter' || key === '=') {
                        e.preventDefault();
                        this.calculate();
                    } else if (key === 'Escape' || key === 'c' || key === 'C') {
                        this.clear();
                    } else if (key === 'Backspace') {
                        this.backspace();
                    } else if (key === '(') {
                        this.appendOperator('(');
                    } else if (key === ')') {
                        this.appendOperator(')');
                    }
                });
            }
        }

        // Initialize calculator when page loads
        window.addEventListener('DOMContentLoaded', () => {
            new ScientificCalculator();
        });
    </script>
</body>
</html>
